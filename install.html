<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   &#160;<span id="projectnumber">2023.01.01</span>
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('install.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>libFMS Installation</h1>
<h2>External Requirements</h2>
<p>The following external libraries are required when building libFMS</p>
<ul>
<li>NetCDF C and Fortran (77/90) headers and libraries</li>
<li>Fortran 2003 standard compiler</li>
<li>Fortran compiler that supports Cray Pointer</li>
<li>MPI C and Fortran headers and libraries (optional)</li>
<li>Libyaml header and libraries (optional)</li>
<li>Linux or Unix style system</li>
</ul>
<h2>Supported Compilers</h2>
<p>We strive to have libFMS built with as many C and Fortran compilers on as many Unix/Linux type systems as possible. However, internally, we only use libFMS compiled with the Intel compilers. Some groups have had success using libFMS when compiled with the GNU C and Fortran compilers.</p>
<h2>MPI Support</h2>
<p>The default way to build libFMS is with MPI support. We have found that using the MPI aware compiler, or the MPI compiler wrappers (mpif90, mpicc, etc.), in general, offer the best results when building with MPI support. If you decide to not use an MPI aware compiler, you should pass the include and library locations to the build system.</p>
<p>libFMS can be built without MPI support (sometimes called "no-comm mode"). To build libFMS without MPI support, pass to <code>configure</code> the <code>--with-mpi=no</code> flag.</p>
<h2>Supported Build Systems</h2>
<p>The FMS repository has two build systems in place, GNU autotools and CMake. It is also compiled with the GFDL's internally-developed build tool, <a href="https://github.com/noaa-gfdl/mkmf">mkmf</a></p>
<p>CMake and Autotools have some variation in options and the resulting build targets.</p>
<p>Autotools will build with 64 bit real defaults unless configured with <code>--enable-mixed-mode</code> in which case it will default to 32 bit reals and add overloads to allow for both 32 bit and 64 bit operations. This results in one library with both 32 bit and 64 bit routines (defaulting to 32 bit reals).</p>
<p>By default CMake will build the library with 32 bit reals. It also has an option for 64 bit defaults , and if enabled will build an additional library with 64 bit reals. This results in distinct 32 bit and 64 bit libraries (libfms_r4.a and libfms_r8.a)</p>
<h3>GNU Autoconf/Automake</h3>
<p>In many cases, running the shell command <code>./configure &amp;&amp; make &amp;&amp; make install</code> will build and install this package. Since libFMS requires the netCDF libraries, you will likely need to tell configure where to find the C and Fortran netCDF headers and libraries via the <code>CPPFLAGS</code>, <code>FCFLAGS</code> and <code>LDFLAGS</code> variables</p>
<div class="fragment"><div class="line">&gt; ./configure CPPFLAGS=&quot;-I/path/to/netcdf/include&quot; \</div>
<div class="line">              FCFLAGS=&quot;-I/path/to/netcdff/include&quot; \</div>
<div class="line">              LDFLAGS=&quot;-L/path/to/netcdf/lib -L/path/to/netcdff/lib&quot;</div>
</div><!-- fragment --><p>When building from a GitHub clone, the user must run <code>autoreconf -i</code> before running the <code>./configure</code> script.</p>
<p>The <code>./configure</code> script will guess as many compiler options as required to build libFMS. In some cases you may be required to supply additional compiler flags for your system. Additional compiler options can be passed to the build with the <code>CPPFLAGS</code>, <code>CFLAGS</code> and <code>FCFLAGS</code> variable. The <code>./configure</code> option <code>--disable-setting-flags</code> will not guess required compiler flags. Using this configure option will require the user to give all required flags.</p>
<p>Run <code>./configure --help</code> to see other available configure options.</p>
<p>For more information on building with autotools and build options please see <a href="https://github.com/NOAA-GFDL/FMS/blob/main/libFMS/BUILD_SYSTEM.md">BUILD_SYSTEM.md</a></p>
<h3>CMake</h3>
<p>To build using CMake, follow the instructions in <a href="https://github.com/NOAA-GFDL/FMS/blob/main/CMAKE_INSTRUCTIONS.md">CMAKE_INSTRUCTIONS.mk</a>. Currently the CMake configuration is the most restrictive build option as the compiler flags are immutable.</p>
<h3>GFDL MKMF</h3>
<p>Make Makefile (<a href="https://github.com/NOAA-GFDL/mkmf">MKMF</a>) is the GFDL developed makefile generator application. MKMF uses a list of file, or a list of directories that contain Fortran or C file, a Make template file, and writes a Makefile with the correct dependencies to build a library or executable. To use MKMF to build libFMS, do the following.</p>
<ol type="1">
<li>Clone the MKMF repository from GitHub <code>git clone <a href="https://github.com/NOAA-GFDL/mkmf.git">https://github.com/NOAA-GFDL/mkmf.git</a></code></li>
<li>Add the <code>mkmf/bin</code> directory to your PATH <code>export PATH=/path/to/mkmf/bin:${PATH}</code> or <code>setenv PATH /path/to/mkmf/bin:${PATH}</code></li>
<li>Run the <code>list_paths</code> command, on the FMS directory <code>list_paths path/to/FMS</code> This will create a path_names file in the current directory</li>
<li>Pick a MKMF template from the <code>mkmf/templates</code> directory that most closely matches you system and compiler. Make any modifications as need</li>
<li>Run <code>mkmf</code> <div class="fragment"><div class="line">mkmf -c &quot;-Duse_netCDF -Duse_libMPI&quot; \</div>
<div class="line">      -I /path/to/netcdff/include \</div>
<div class="line">      -I /path/to/netcdf/include \</div>
<div class="line">      -t /path/to/mkmf/template. \</div>
<div class="line">      -p libfms.a \</div>
<div class="line">      path_names</div>
</div><!-- fragment --></li>
<li>Once built, place the <code>libfms.a</code>, <code>*.mod</code>, <code>include/\*</code> files in your install location.</li>
</ol>
<p>While MKMF has been the build system used by GFDL to build all the GFDL models for some time, this build method requires the most user intervention when building libFMS on a new system. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="build.html">Building and Installation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
