<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: Drifters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   &#160;<span id="projectnumber">2023.01.01</span>
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__drifters.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Drifters</div>  </div>
</div><!--header-->
<div class="contents">

<p>Modules and associated files in the drifters directory.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__cloud__interpolator__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cloud__interpolator__mod.html">cloud_interpolator_mod</a></td></tr>
<tr class="memdesc:group__cloud__interpolator__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cloud interpolation routines for use in <a class="el" href="group__drifters__mod.html">drifters_mod</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__drifters__comm__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drifters__comm__mod.html">drifters_comm_mod</a></td></tr>
<tr class="memdesc:group__drifters__comm__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routines and types to update drifter positions across processor domains. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__drifters__core__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drifters__core__mod.html">drifters_core_mod</a></td></tr>
<tr class="memdesc:group__drifters__core__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the mechanics for adding and removing drifters. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__drifters__input__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drifters__input__mod.html">drifters_input_mod</a></td></tr>
<tr class="memdesc:group__drifters__input__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight">Imports initial drifter positions from a netCDF file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__drifters__io__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drifters__io__mod.html">drifters_io_mod</a></td></tr>
<tr class="memdesc:group__drifters__io__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves drifter data for postprocessing and restarts. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__drifters__mod"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drifters__mod.html">drifters_mod</a></td></tr>
<tr class="memdesc:group__drifters__mod"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>Drifters_mod</code>is a module designed to advect a set of particles, in parallel or sequentially, given an prescribed velocity field. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__quicksort"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__quicksort.html">quicksort</a></td></tr>
<tr class="memdesc:group__quicksort"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fortran implementation of quicksort to be used in drifters_core. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Modules and associated files in the drifters directory. </p>


<h3><a id="md_drifters_README"></a>README</h3><div class="textblock"><h1>Drifters</h1>
<a href="#" onclick="location.href='mai'+'lto:'+'Ale'+'xa'+'nde'+'r.'+'Ple'+'tz'+'er@'+'no'+'aa.'+'go'+'v'; return false;">Alexa<span style="display: none;">.nosp@m.</span>nder<span style="display: none;">.nosp@m.</span>.Plet<span style="display: none;">.nosp@m.</span>zer@<span style="display: none;">.nosp@m.</span>noaa.<span style="display: none;">.nosp@m.</span>gov</a><h2>Overview:</h2>
<ol type="1">
<li><a href="#1-what-are-drifters">What are drifters?</a></li>
<li><a href="#2-the-drifters-module">The drifters' module</a></li>
<li><a href="#3-what-the-drifters-module-can-and-cannot-do">What the drifters' module can and cannot do?</a></li>
<li><a href="#4-how-to-invoke-the-drifters-module-in-your-code">How to invoke the drifters' module in your code</a></li>
<li><a href="#5-pre-and-post-processing">Pre- and post-processing</a></li>
<li><a href="#6-loose-ends">Loose ends</a></li>
</ol>
<h2>1. What are drifters?</h2>
Drifters are idealized point particles with positions that evolve in time according to a prescribed velocity field, starting from some initial conditions. Drifters have no mass, no energy, no size, and no friction and therefore have no impact on the dynamics of the underlying system. The only feature that distinguishes a drifter from another is its trajectory. This makes drifters ideal for tracking pollution clouds and probing fields (e.g. temperature, salinity) along ocean currents. Drifters can mimic real experiments such as the Argo floats <a href="http://www.metoffice.com/research/ocean/argo/ukfloats.html">http://www.metoffice.com/research/ocean/argo/ukfloats.html</a>.<h2>2. The drifters' module</h2>
The drifters' module (drifters_mod) is a Fortran module built on top of low level kernels. The code was designed to run in parallel within a coupled FMS model.The general layout is:<h5>Top layer:</h5>
<ul>
<li><a class="el" href="drifters_8F90_source.html">drifters.F90</a>: exposes the API</li>
</ul>
<h5>Some low level kernels:</h5>
<ul>
<li><a class="el" href="cloud__interpolator_8F90_source.html">cloud_interpolator.F90</a>: (linear) interpolation of a structured field at random positions</li>
<li><a class="el" href="drifters__comm_8F90_source.html">drifters_comm.F90</a>: updates positions across processor (PE) domains</li>
<li><a class="el" href="drifters__core_8F90_source.html">drifters_core.F90</a>: handles the mechanics for adding/removing drifters</li>
<li><a class="el" href="drifters__input_8F90_source.html">drifters_input.F90</a>: imports initial positions from a NetCDF file</li>
<li><a class="el" href="drifters__io_8F90_source.html">drifters_io.F90</a>: saves data for postprocessing and restart</li>
</ul>
<h2>3. What the drifters' module can and cannot do?</h2>
The drifters' module will handle all the communication necessary to keep track of positions within PE domains. This will involve adding/removing drifters when they enter/leave a PE domain. As the number of drifters can vary greatly both between PE domains and in the course of a simulation, the drifters' module will also manage dynamically the memory for you.The drifters' code was written to run efficiently by avoiding unnecessary data copies. There is no software limit as to the maximum number of drifters and their distribution. The drifters' module is ideally suited for long runs where the amount of data required to advect particles is large, making it impractical to use a post-processing approach. Such a situation occurs, in particular, when the velocity fields must be saved at high sampling rate in order to compute accurately the drifters' positions.Although a Runge-Kutta method is provided to push drifters, users may want to implement their own time-integration scheme in some cases. It is moreover possible to combine time integration along some axes while prescribing the evolution in the third axis, as would be the case for robotic floats that move up and down in predetermined way, for instance.There are a number of basic assumptions which could make the drifters' module ill-suited for some tasks. First and foremost, it is assumed that the motion of drifters is not erratic but follows deterministic trajectories. Furthermore, drifters should not cross both compute and data domain boundaries within less than a time step. This limitation is imposed by the Runge-Kutta integration scheme, which must be able to complete, within a time step, a trajectory calculation that starts inside the compute domain. Therefore, the drifters, as they are presently modeled, are unlikely to work for very fast objects. This constraint also puts a upper limit to the domain decomposition, although it can often be remedied by increasing the number of ghost nodes.Another fundamental assumption is that the (e.g. velocity) fields are structured, on a per PE domain basis. There is no support for locally nested or unstructured meshes. Meshes need not be smooth and continuous across PE domains, however.If the higher level module drifters_mod cannot do what you need, the chances are the kernels will be able to. For instance, the upper level assumes, at present, two-dimensional (x,y) positions, and a two-dimension domain decomposition. The cloud_interpolator kernel on the other hand makes no such assumption; it can be used to interpolate structured data in arbitrary number of dimensions and with no dependence on FMS code.<h2>4. How to invoke the drifters' module in your code</h2>
In order to implement drifters in your code, you will need to get access to the velocity fields at all times. You will also need to settle on a definition of a position, which could be the longitude, latitude, elevation/depth triplet. The drifters' code does not care what your choice of position is. Typically, you will want, however, to choose positions that are aligned to the velocity axes, and to your coordinate system. It is perfectly fine to use a warped coordinate system (e.g. tripolar), which avoids the problem of geometric singularity (pole).Naturally, it is important for the velocity field's units to be consistent with both positions and time. Often, some metric coefficients are required for this transformation. The drifters' module does not have any support for specific meshes per se. Each component of the velocity can sit on different nodes, as in the case of Arakawa C and D meshes.You will also need to know what the boundaries of your "compute" and "data" domains are, when running in parallel. Your compute domain, expressed in terms of <code>xcmin</code>, <code>xcmax</code>, <code>ycmin</code> and <code>ycmax</code> should densely cover the entire domain; that is </p><div class="fragment"><div class="line">xcmin[pe_east]  = xcmax[pe]</div>
<div class="line">ycmin[pe_north] = ycmax[pe]</div>
<div class="line">etc.</div>
</div><!-- fragment -->The data domain should be larger than the compute domain. The larger the velocities or the larger the time steps, the more ghost nodes are required. You should also pay attention to the fact that <em>all</em> components of your velocity need to fall inside the data domain. If you're using a staggered grid (Arakawa's B, C grids) you should reduce the max data domain by <code>dx</code>, resp. <code>dy</code>, in every direction.The implementation of drifters involves typically the following steps, which will be assumed to run on different PEs:<div class="fragment"><div class="line"><span class="keywordtype">use </span>drifters_mod</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">! declare drifters object</span></div>
<div class="line"><span class="keywordtype">type</span>(drifters_type) :: drfts <span class="comment">! drifters&#39; object</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">! constructor</span></div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#gaddfba33d6e4b7bdc50a58a1be1e3489b">drifters_new</a>(drfts, &amp;</div>
<div class="line">     &amp; input_file =<span class="stringliteral">&#39;INPUT/drifters_inp.nc&#39;</span>  , &amp;</div>
<div class="line">     &amp; output_file=<span class="stringliteral">&#39;drifters_out.nc&#39;</span>, &amp;</div>
<div class="line">     &amp; ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! set the initial time and dt</span></div>
<div class="line">drfts%time = t0</div>
<div class="line">drfts%dt   = dt</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">! set the PE domain boundaries. Xmin_comp/ymin_comp, xmax_comp/ymax_comp</span></div>
<div class="line"><span class="comment">! refer to the &quot;compute&quot; domain, which should cover densily the domain:</span></div>
<div class="line"><span class="comment">! xcmax[pe] = xcmin[pe_east]</span></div>
<div class="line"><span class="comment">! ycmax[pe] = ycmin[pe_north]</span></div>
<div class="line"><span class="comment">! Xmin_data/ymin_data, xmax_data/ymax_data refer to the &quot;data&quot; domain, which</span></div>
<div class="line"><span class="comment">! should be larger than the compute domain and therefore overlap:</span></div>
<div class="line"><span class="comment">! xdmax[pe] &gt; xdmin[pe_east]</span></div>
<div class="line"><span class="comment">! ydmax[pe] &gt; ydmin[pe_north]</span></div>
<div class="line"><span class="comment">! Particles in the overlap regions are tracked by several PEs.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#gaf48b96da0cba62052592800e59ec7529">drifters_set_domain</a>(drfts, &amp;</div>
<div class="line">     &amp; xmin_comp=xcmin, xmax_comp=xcmax, &amp;</div>
<div class="line">     &amp; ymin_comp=ycmin, ymax_comp=ycmax, &amp;</div>
<div class="line">     &amp; xmin_data=xdmin, xmax_data=xdmax, &amp;</div>
<div class="line">     &amp; ymin_data=ydmin, ymax_data=ydmax, &amp;</div>
<div class="line">     &amp; xmin_glob=xmin , xmax_glob=xmax,  &amp; <span class="comment">! this will set periodicity in x</span></div>
<div class="line">     &amp; ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! set neighboring PEs [domain2d is of type(domain2d)]</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#gaa90f5c5c61f3e1f0a686b87cece0c1d6">drifters_set_pe_neighbors</a>(drfts, domain=domain2d, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! set the velocities axes. Each velocity can have different axes.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#ga2d38270021bffd79cb60096459b3ae7e">drifters_set_v_axes</a>(drfts, component=<span class="stringliteral">&#39;u&#39;</span>, &amp;</div>
<div class="line">     &amp; x=x_u, y=y_u, z=z_u, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#ga2d38270021bffd79cb60096459b3ae7e">drifters_set_v_axes</a>(drfts, component=<span class="stringliteral">&#39;v&#39;</span>, &amp;</div>
<div class="line">     &amp; x=x_v, y=y_v, z=z_v, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">! Distribute the drifters across PEs</span></div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#ga9a1aa7c59e21aeab310b3fd722ced015">drifters_distribute</a>(drfts, ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! Push the drifters. u_comp, v_comp etc are provided by the host code</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#interfacedrifters__mod_1_1drifters__push">drifters_push</a>(drfts, u=u_comp, v=v_comp, w=w_comp, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">do</span> <span class="keywordflow">while</span> (time &lt; time_end)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! Update the velocities</span></div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line"><span class="comment">! Push the drifters</span></div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#interfacedrifters__mod_1_1drifters__push">drifters_push</a>(drfts, u=u_comp, v=v_comp, w=w_comp, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! check if RK4 integration is complete</span></div>
<div class="line"><span class="keywordflow">if</span>(drfts%rk4_step==1) <span class="keywordflow">then</span></div>
<div class="line"> </div>
<div class="line">     <span class="comment">! interpolate fields</span></div>
<div class="line"> </div>
<div class="line">     <span class="keyword">call </span><a class="code" href="group__drifters__mod.html#interfacedrifters__mod_1_1drifters__set__field">drifters_set_field</a>(drfts, index_field=1, x=x1, y=y1, z=z1, &amp;</div>
<div class="line">     &amp;    data=temp, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line">     .... <span class="comment">! set other fields here</span></div>
<div class="line"> </div>
<div class="line">     <span class="comment">! save data</span></div>
<div class="line"> </div>
<div class="line">     <span class="keyword">call </span><a class="code" href="group__drifters__mod.html#gae5f4a850b28c0132197541725ed0a933">drifters_save</a>(drfts, ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">enddo</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"><span class="comment">! write restart file, optionally with lon/lat data coordinates</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#ga3e7db869b8b17f17d7c07b3c2b0cc5c2">drifters_write_restart</a>(drfts, filename=<span class="stringliteral">&#39;RESTART/drifters_inp.nc&#39;</span>, &amp;</div>
<div class="line">     &amp; x1=x_u, y1=y_v, geolon1=grid%geolonq, &amp;</div>
<div class="line">     &amp; x2=x_u, y2=y_v, geolat2=grid%geolatq, &amp;</div>
<div class="line">     &amp; ermesg=ermesg)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">! destroy</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span><a class="code" href="group__drifters__mod.html#gabd7a7c5d6f87429d1f125fccbbbf9a5a">drifters_del</a>(drfts, ermesg=ermesg)</div>
<div class="ttc" id="agroup__drifters__mod_html_ga2d38270021bffd79cb60096459b3ae7e"><div class="ttname"><a href="group__drifters__mod.html#ga2d38270021bffd79cb60096459b3ae7e">drifters_mod::drifters_set_v_axes</a></div><div class="ttdeci">subroutine, public drifters_set_v_axes(self, component, x, y, z, ermesg)</div><div class="ttdoc">Set velocity field axes.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00666">drifters.F90:667</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_ga3e7db869b8b17f17d7c07b3c2b0cc5c2"><div class="ttname"><a href="group__drifters__mod.html#ga3e7db869b8b17f17d7c07b3c2b0cc5c2">drifters_mod::drifters_write_restart</a></div><div class="ttdeci">subroutine, public drifters_write_restart(self, filename, x1, y1, geolon1, x2, y2, geolat2, root, mycomm, ermesg)</div><div class="ttdoc">Write restart file for drifters.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00582">drifters.F90:586</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_ga9a1aa7c59e21aeab310b3fd722ced015"><div class="ttname"><a href="group__drifters__mod.html#ga9a1aa7c59e21aeab310b3fd722ced015">drifters_mod::drifters_distribute</a></div><div class="ttdeci">subroutine, public drifters_distribute(self, ermesg)</div><div class="ttdoc">Distribute particles across PEs.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00547">drifters.F90:548</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_gaa90f5c5c61f3e1f0a686b87cece0c1d6"><div class="ttname"><a href="group__drifters__mod.html#gaa90f5c5c61f3e1f0a686b87cece0c1d6">drifters_mod::drifters_set_pe_neighbors</a></div><div class="ttdeci">subroutine, public drifters_set_pe_neighbors(self, domain, ermesg)</div><div class="ttdoc">Given an MPP based deomposition, set the PE numbers that are adjacent to this processor.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00451">drifters.F90:452</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_gabd7a7c5d6f87429d1f125fccbbbf9a5a"><div class="ttname"><a href="group__drifters__mod.html#gabd7a7c5d6f87429d1f125fccbbbf9a5a">drifters_mod::drifters_del</a></div><div class="ttdeci">subroutine, public drifters_del(self, ermesg)</div><div class="ttdoc">Destructor, call this to reclaim memory from data used for drifters.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00277">drifters.F90:278</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_gaddfba33d6e4b7bdc50a58a1be1e3489b"><div class="ttname"><a href="group__drifters__mod.html#gaddfba33d6e4b7bdc50a58a1be1e3489b">drifters_mod::drifters_new</a></div><div class="ttdeci">subroutine, public drifters_new(self, input_file, output_file, ermesg)</div><div class="ttdoc">Will read positions stored in the netCDF file input_file.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00189">drifters.F90:190</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_gae5f4a850b28c0132197541725ed0a933"><div class="ttname"><a href="group__drifters__mod.html#gae5f4a850b28c0132197541725ed0a933">drifters_mod::drifters_save</a></div><div class="ttdeci">subroutine, public drifters_save(self, ermesg)</div><div class="ttdoc">Append new positions to NetCDF file.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00525">drifters.F90:526</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_gaf48b96da0cba62052592800e59ec7529"><div class="ttname"><a href="group__drifters__mod.html#gaf48b96da0cba62052592800e59ec7529">drifters_mod::drifters_set_domain</a></div><div class="ttdeci">subroutine, public drifters_set_domain(self, xmin_comp, xmax_comp, ymin_comp, ymax_comp, xmin_data, xmax_data, ymin_data, ymax_data, xmin_glob, xmax_glob, ymin_glob, ymax_glob, ermesg)</div><div class="ttdoc">Set the compute, data, and global domain boundaries.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00400">drifters.F90:405</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_interfacedrifters__mod_1_1drifters__push"><div class="ttname"><a href="group__drifters__mod.html#interfacedrifters__mod_1_1drifters__push">drifters_mod::drifters_push</a></div><div class="ttdoc">&quot;Push&quot; a given drifter at a given velocity for either 2D or 3D data</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00162">drifters.F90:162</a></div></div>
<div class="ttc" id="agroup__drifters__mod_html_interfacedrifters__mod_1_1drifters__set__field"><div class="ttname"><a href="group__drifters__mod.html#interfacedrifters__mod_1_1drifters__set__field">drifters_mod::drifters_set_field</a></div><div class="ttdoc">Set the value of a given drifter field.</div><div class="ttdef"><b>Definition:</b> <a href="drifters_8F90_source.html#l00175">drifters.F90:175</a></div></div>
</div><!-- fragment --><h2>5. Pre- and post-processing</h2>
A typical NetCDF input file contains:<div class="fragment"><div class="line">netcdf drifters_inp {</div>
<div class="line">dimensions:</div>
<div class="line">  nd = 2 ; // number of dimensions (2 or 3)</div>
<div class="line">  np = 5 ; // number of particles</div>
<div class="line">variables:</div>
<div class="line">  double positions(np, nd) ;</div>
<div class="line">  positions:names = &quot;i j&quot; ;</div>
<div class="line">  positions:units = &quot;- -&quot; ;</div>
<div class="line">  int ids(np) ;</div>
<div class="line"> </div>
<div class="line">// global attributes:</div>
<div class="line">  :velocity_names = &quot;u v&quot; ;</div>
<div class="line">  :field_names = &quot;lon lat temp salt&quot; ;</div>
<div class="line">  :field_units = &quot;deg_N deg_E Celsius ppu&quot; ;</div>
<div class="line">  :time_units = &quot;seconds&quot; ;</div>
<div class="line">  :title = &quot;example of input data for drifters&quot; ;</div>
<div class="line">data:</div>
<div class="line"> </div>
<div class="line"> positions =</div>
<div class="line">  240, 100,</div>
<div class="line">  240, 110,</div>
<div class="line">  240, 120,</div>
<div class="line">  240, 130,</div>
<div class="line">  240, 140 ;</div>
<div class="line"> </div>
<div class="line"> ids = 1, 2, 3, 4, 5 ; // must range from 1 to np, in any order</div>
<div class="line">}</div>
</div><!-- fragment -->In this case, the 2-d initial conditions consist of 5 particles at positions (240,100), (240, 110), .... Here, the positions are defined as i, j global indices. The fields to interpolate are the longitudes, latitudes, temperature and salinity.The output files have names <code>&lt;output&gt;.nc.&lt;PE&gt;</code> where PE ranges 0...number of domains-1. Each PE writes to an independent NetCDF file. These files contain a history of positions and field values:<div class="fragment"><div class="line">netcdf drifters_out.nc {</div>
<div class="line">dimensions:</div>
<div class="line">  it_id = UNLIMITED ; // (10 currently)</div>
<div class="line">  nf = 4 ;</div>
<div class="line">  nd = 2 ;</div>
<div class="line">variables:</div>
<div class="line">  int index_time(it_id) ;</div>
<div class="line">  double time(it_id) ;</div>
<div class="line">  int ids(it_id) ;</div>
<div class="line">  double positions(it_id, nd) ;</div>
<div class="line">  positions:name_1 = &quot;i&quot; ;</div>
<div class="line">  positions:name_2 = &quot;j&quot; ;</div>
<div class="line">  positions:unit_1 = &quot;-&quot; ;</div>
<div class="line">  positions:unit_2 = &quot;-&quot; ;</div>
<div class="line">  double fields(it_id, nf) ;</div>
<div class="line">  fields:name_1 = &quot;lon&quot; ;</div>
<div class="line">  fields:name_2 = &quot;lat&quot; ;</div>
<div class="line">  fields:name_3 = &quot;temp&quot; ;</div>
<div class="line">  fields:name_4 = &quot;salt&quot; ;</div>
<div class="line">  fields:unit_1 = &quot;deg_N&quot; ;</div>
<div class="line">  fields:unit_2 = &quot;deg_E&quot; ;</div>
<div class="line">  fields:unit_3 = &quot;Celsius&quot; ;</div>
<div class="line">  fields:unit_4 = &quot;ppu&quot; ;</div>
<div class="line"> </div>
<div class="line">// global attributes:</div>
<div class="line">  :time_units = &quot;seconds&quot; ;</div>
<div class="line">data:</div>
<div class="line"> </div>
<div class="line"> index_time = 0, 0, 1, 1, 2, 2, 3, 3, 4, 4 ;</div>
<div class="line"> </div>
<div class="line"> time = 17280, 17280, 34560, 34560, 51840, 51840, 69120, 69120, 86400, 86400 ;</div>
<div class="line"> </div>
<div class="line"> ids = 1, 2, 1, 2, 1, 2, 1, 2, 1, 2 ;</div>
<div class="line"> </div>
<div class="line"> positions =</div>
<div class="line">  239.992427824695, 99.9982201799336,</div>
<div class="line">  239.992780388996, 110.000731652201,</div>
<div class="line">...</div>
<div class="line"> fields =</div>
<div class="line">  -52.5075721753049, 11.5056520209176, 26.5841099585423, 35.4729937970157,</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment -->A tool, drifters_combine, has been written to combine all the NetCDF files into a single file, which contains all the drifters data and is suitable for post-processing, including visualization using Ncvtk 1.7 or later.<h2>6. Loose ends</h2>
<ul>
<li>What to do with fields that are outside the valid_range (e.g. on continents in the case of floats). Use piece-wise linear interpolation or fill with missing values?</li>
<li>How to make the drifters Mosaic compliant?</li>
<li>Allow drifters to turn on/off at specific time? A predetermined life cycle?</li>
<li>Extract initial positions from databases.</li>
<li>How best to visualize drifters? </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
